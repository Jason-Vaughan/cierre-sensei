{
    "metadata": {
        "version": "2.1.0",
        "last_updated": "2025-12-01",
        "default_currency": "USD",
        "description": "Comprehensive closing costs database for Mexican real estate transactions including all 32 states - RESIDENTIAL PROPERTIES ONLY",
        "notes": "ISAI rates apply to RESIDENTIAL properties only (condos, houses, residential land) - NOT commercial, agricultural, or other property types. Rates and fees vary by state and municipality. Source: December 2025 state finance laws via SAT/SHCP. Always verify with local authorities.",
        "sponsor_text": {
            "intro": "brought to you by:",
            "company": "PV Lives Here",
            "website": "https://pvliveshere.com/",
            "tagline": "We Are Your Real Estate Professionals - contact us for add placement",
            "contact": "WhatsApp at +52 777 267 7989 | info@pvliveshere.com | https://www.facebook.com/pvliveshere - Contact Info Here"
        }
    },
    "fee_definitions": [
        {
            "id": "escrow_fee",
            "category": "Escrow",
            "subcategory": "Escrow Fee",
            "calc_type": "fixed",
            "default_value": 750,
            "description": "Standard escrow service fee for property transaction coordination",
            "varies_by_state": false,
            "required": false,
            "paid_by": "buyer"
        },
        {
            "id": "notarial_fees",
            "category": "Notarial Fees",
            "subcategory": "General",
            "calc_type": "percent_range",
            "default_percent_min": 0.6,
            "default_percent_max": 1.0,
            "description": "All notary fees for drafting and executing the public deed (Escritura Pública)",
            "varies_by_state": true,
            "required": true,
            "paid_by": "buyer",
            "notes": "Includes notary professional fees, deed preparation, and notarization"
        },
        {
            "id": "acquisition_tax_isai",
            "category": "Acquisition Taxes",
            "subcategory": "ISAI",
            "calc_type": "percent",
            "description": "Impuesto Sobre Adquisición de Inmuebles - charged on purchase price or assessed value (whichever is higher). RESIDENTIAL PROPERTIES ONLY.",
            "varies_by_state": true,
            "required": true,
            "paid_by": "buyer",
            "notes": "Most significant state-level tax. Rates vary significantly by state from 0.02% to 6%. Applies to residential properties (condos, houses, residential land) only. Expats generally do not qualify for primary residence discounts or social housing subsidies."
        },
        {
            "id": "registration_fee",
            "category": "Registration Fees",
            "subcategory": "Gastos de Registro",
            "calc_type": "percent_range",
            "default_percent_min": 0.2,
            "default_percent_max": 0.5,
            "description": "Registration of the deed with the Public Registry of Property",
            "varies_by_state": true,
            "required": true,
            "paid_by": "buyer"
        },
        {
            "id": "fideicomiso_setup",
            "category": "Fideicomiso",
            "subcategory": "Initial Setup",
            "calc_type": "fixed_range",
            "default_min": 1000,
            "default_max": 2000,
            "description": "Bank trust setup for foreigners in restricted zones (within 50km of coast or 100km of border)",
            "varies_by_state": false,
            "required": false,
            "paid_by": "buyer",
            "notes": "Only required for foreign buyers in restricted zones. Includes Foreign Investment Permit and Public Registry of Commerce registration"
        },
        {
            "id": "fideicomiso_annual",
            "category": "Fideicomiso",
            "subcategory": "Annual Trustee Fee",
            "calc_type": "fixed_range",
            "default_min": 500,
            "default_max": 800,
            "description": "Annual bank trustee maintenance fee",
            "varies_by_state": false,
            "required": false,
            "paid_by": "buyer",
            "notes": "Ongoing annual cost for maintaining the trust (USD equivalent). Varies by bank."
        },
        {
            "id": "fideicomiso_permit",
            "category": "Fideicomiso",
            "subcategory": "Government Permit",
            "calc_type": "fixed",
            "default_value": 1100,
            "description": "One-time Mexican government fee for trust establishment permission",
            "varies_by_state": false,
            "required": false,
            "paid_by": "buyer",
            "notes": "Paid to Mexican government (USD equivalent)"
        },
        {
            "id": "certificate_no_liens",
            "category": "Certificates",
            "subcategory": "Certificate of No Liens",
            "calc_type": "fixed_range",
            "default_min": 30,
            "default_max": 40,
            "description": "Confirms no liens or encumbrances on the property",
            "varies_by_state": true,
            "required": true,
            "paid_by": "buyer",
            "notes": "In Jalisco, issued by IRCEJ (Instituto Registral y Catastral del Estado de Jalisco)"
        },
        {
            "id": "certificate_no_tax_debts",
            "category": "Certificates",
            "subcategory": "Certificate of No Tax Debts",
            "calc_type": "fixed_range",
            "default_min": 10,
            "default_max": 20,
            "description": "Confirms no outstanding state or municipal property taxes (Predial)",
            "varies_by_state": true,
            "required": true,
            "paid_by": "buyer",
            "notes": "Issued by state treasury (Secretaría de Hacienda)"
        },
        {
            "id": "appraisal_fee",
            "category": "Professional Services",
            "subcategory": "Appraisal",
            "calc_type": "percent_range",
            "default_percent_min": 0.1,
            "default_percent_max": 0.5,
            "description": "Independent property valuation required for transaction",
            "varies_by_state": false,
            "required": true,
            "paid_by": "buyer"
        },
        {
            "id": "title_search",
            "category": "Title Services",
            "subcategory": "Preliminary Title Search",
            "calc_type": "fixed_range",
            "default_min": 0,
            "default_max": 500,
            "description": "Research to verify clear title and identify potential issues",
            "varies_by_state": false,
            "required": false,
            "paid_by": "buyer",
            "notes": "Optional but recommended; cost varies by property complexity"
        },
        {
            "id": "title_insurance",
            "category": "Title Services",
            "subcategory": "Title Insurance",
            "calc_type": "fixed_range",
            "default_min": 500,
            "default_max": 2000,
            "description": "Optional insurance policy protecting against title defects",
            "varies_by_state": false,
            "required": false,
            "paid_by": "buyer",
            "notes": "Not common in Mexico but available from international providers"
        },
        {
          "id": "legal_representation",
          "category": "Professional Services",
          "subcategory": "Legal Representation",
          "calc_type": "percent_range",
          "default_percent_min": 0.5,
          "default_percent_max": 1.0,
          "description": "Attorney fees for representing buyer throughout transaction",
          "varies_by_state": false,
          "required": false,
          "paid_by": "buyer",
          "notes": "Highly recommended for foreign buyers; fees vary by complexity"
        },
        {
            "id": "translator_fees",
            "category": "Professional Services",
            "subcategory": "Translation Services",
            "calc_type": "fixed_range",
            "default_min": 200,
            "default_max": 500,
            "description": "Official translation of documents for foreign buyers",
            "varies_by_state": false,
            "required": false,
            "paid_by": "buyer",
            "notes": "Required for documents not in Spanish"
        }
    ],
    "state_rates": {
        "Aguascalientes": {
            "acquisition_tax_isai": {
                "percent": 2.0,
                "notes": "Flat 2% ISAI rate for residential properties. 50% subsidy available for homes/condos ≤ $800K MXN (expats typically do not qualify)."
            },
            "notarial_fees": {
                "percent_min": 0.6,
                "percent_max": 1.0
            },
            "registration_fee": {
                "percent_min": 0.2,
                "percent_max": 0.4
            }
        },
        "Baja California": {
            "acquisition_tax_isai": {
                "percent_min": 2.0,
                "percent_max": 6.5,
                "notes": "Flat 2% ISAI rate for residential properties; up to 6.5% for luxury condos/land in border areas (e.g., Tijuana). Restricted zone applies (foreigners need fideicomiso)."
            },
            "notarial_fees": {
                "percent_min": 0.7,
                "percent_max": 1.2
            },
            "registration_fee": {
                "percent_min": 0.3,
                "percent_max": 0.5
            },
            "restricted_zone": true
        },
        "Baja California Sur": {
            "acquisition_tax_isai": {
                "percent": 3.0,
                "notes": "Flat 3% ISAI rate for residential properties; reduced to 1.5% for social housing ≤ $1.2M MXN (Los Cabos condos) - expats typically do not qualify. Restricted zone applies."
            },
            "notarial_fees": {
                "percent_min": 0.7,
                "percent_max": 1.2
            },
            "registration_fee": {
                "percent_min": 0.3,
                "percent_max": 0.5
            },
            "restricted_zone": true
        },
        "Campeche": {
            "acquisition_tax_isai": {
                "percent": 2.0,
                "notes": "Flat 2% ISAI rate for residential properties. Exemptions for rural residential land ≤ $500K MXN (expats typically do not qualify). Gulf coast state - restricted zone applies."
            },
            "notarial_fees": {
                "percent_min": 0.6,
                "percent_max": 0.9
            },
            "registration_fee": {
                "percent_min": 0.2,
                "percent_max": 0.4
            },
            "restricted_zone": true
        },
        "Chiapas": {
            "acquisition_tax_isai": {
                "percent": 1.0,
                "notes": "Flat 1% ISAI rate for residential properties; one of the lowest in Mexico. Full exemptions for indigenous/rural houses ≤ $500K MXN (expats typically do not qualify). Restricted zone applies."
            },
            "notarial_fees": {
                "percent_min": 0.5,
                "percent_max": 0.8
            },
            "registration_fee": {
                "percent_min": 0.2,
                "percent_max": 0.3
            },
            "restricted_zone": true
        },
        "Chihuahua": {
            "acquisition_tax_isai": {
                "percent_min": 2.0,
                "percent_max": 3.0,
                "notes": "Flat 2% ISAI rate for residential properties; municipal variations up to 3% in border condos. Border state with USA - restricted zone applies."
            },
            "notarial_fees": {
                "percent_min": 0.6,
                "percent_max": 1.0
            },
            "registration_fee": {
                "percent_min": 0.2,
                "percent_max": 0.4
            },
            "restricted_zone": true
        },
        "Coahuila": {
            "acquisition_tax_isai": {
                "percent": 3.0,
                "notes": "Flat 3% ISAI rate for residential properties. 50% subsidy for low-income homes/condos ≤ $1M MXN (expats typically do not qualify). Border state with Texas - restricted zone applies."
            },
            "notarial_fees": {
                "percent_min": 0.6,
                "percent_max": 1.0
            },
            "registration_fee": {
                "percent_min": 0.2,
                "percent_max": 0.4
            },
            "restricted_zone": true
        },
        "Colima": {
            "acquisition_tax_isai": {
                "percent": 2.0,
                "notes": "Flat 2% ISAI rate for residential properties. Minor cuts for social interest condos (expats typically do not qualify). Pacific coast state - restricted zone applies."
            },
            "notarial_fees": {
                "percent_min": 0.6,
                "percent_max": 0.9
            },
            "registration_fee": {
                "percent_min": 0.2,
                "percent_max": 0.4
            },
            "restricted_zone": true
        },
        "Durango": {
            "acquisition_tax_isai": {
                "percent": 2.0,
                "notes": "Flat 2% ISAI rate for residential properties. Full exemption for social homes/land ≤ $700K MXN (expats typically do not qualify)."
            },
            "notarial_fees": {
                "percent_min": 0.6,
                "percent_max": 0.9
            },
            "registration_fee": {
                "percent_min": 0.2,
                "percent_max": 0.4
            }
        },
        "Guanajuato": {
            "acquisition_tax_isai": {
                "percent": 1.0,
                "notes": "Flat 1% ISAI rate for residential properties; one of the lowest in Mexico. San Miguel de Allende located here. Up to 100% incentive for first homes/condos ≤ $800K MXN (expats typically do not qualify)."
            },
            "notarial_fees": {
                "percent_min": 0.6,
                "percent_max": 0.9
            },
            "registration_fee": {
                "percent_min": 0.2,
                "percent_max": 0.3
            }
        },
        "Guerrero": {
            "acquisition_tax_isai": {
                "percent": 2.0,
                "notes": "Flat 2% ISAI rate for residential properties; reduced to 1% for coastal social housing ≤ $600K MXN (expats typically do not qualify). Includes Acapulco and Ixtapa - restricted zone applies."
            },
            "notarial_fees": {
                "percent_min": 0.6,
                "percent_max": 1.0
            },
            "registration_fee": {
                "percent_min": 0.2,
                "percent_max": 0.4
            },
            "restricted_zone": true
        },
        "Hidalgo": {
            "acquisition_tax_isai": {
                "percent": 2.0,
                "notes": "Flat 2% ISAI rate for residential properties. General low-value exemptions ≤ $500K MXN for residential land (expats typically do not qualify)."
            },
            "notarial_fees": {
                "percent_min": 0.6,
                "percent_max": 0.9
            },
            "registration_fee": {
                "percent_min": 0.2,
                "percent_max": 0.4
            }
        },
        "Jalisco": {
            "acquisition_tax_isai": {
                "percent": 2.0,
                "notes": "Flat 2% ISAI rate for residential properties (per finanzas.jalisco.gob.mx). Includes Guadalajara and Puerto Vallarta. Restricted zone applies."
            },
            "notarial_fees": {
                "percent_min": 0.7,
                "percent_max": 1.0
            },
            "registration_fee": {
                "percent_min": 0.2,
                "percent_max": 0.4
            },
            "restricted_zone": true,
            "certificate_no_liens": {
                "value_min": 30,
                "value_max": 40,
                "issuer": "IRCEJ (Instituto Registral y Catastral del Estado de Jalisco)"
            }
        },
        "Mexico City": {
            "acquisition_tax_isai": {
                "percent_min": 2.0,
                "percent_max": 6.0,
                "notes": "Progressive ISAI rate 2%-6% for residential properties based on property value (e.g., 2% up to $1M MXN for houses/condos, tiered by value). Applies to urban land. Source: finanzas.cdmx.gob.mx"
            },
            "notarial_fees": {
                "percent_min": 0.8,
                "percent_max": 1.5
            },
            "registration_fee": {
                "percent_min": 0.3,
                "percent_max": 0.5
            }
        },
        "Estado de México": {
            "acquisition_tax_isai": {
                "percent_min": 0.02,
                "percent_max": 4.5,
                "notes": "Progressive ISAI rate 0.02%-4.5% for residential properties, varies by municipality and value (e.g., 2% average for mid-range houses); thresholds up to 4.7%. State of Mexico (surrounding Mexico City)."
            },
            "notarial_fees": {
                "percent_min": 0.7,
                "percent_max": 1.0
            },
            "registration_fee": {
                "percent_min": 0.2,
                "percent_max": 0.4
            }
        },
        "Michoacán": {
            "acquisition_tax_isai": {
                "percent": 2.0,
                "notes": "Flat 2% ISAI rate for residential properties. 50% subsidy for social housing/land ≤ $700K MXN (expats typically do not qualify). Includes coastal areas - restricted zone applies."
            },
            "notarial_fees": {
                "percent_min": 0.6,
                "percent_max": 0.9
            },
            "registration_fee": {
                "percent_min": 0.2,
                "percent_max": 0.4
            },
            "restricted_zone": true
        },
        "Morelos": {
            "acquisition_tax_isai": {
                "percent": 2.0,
                "notes": "Flat 2% ISAI rate for residential properties. Exemptions mainly for family transfers of condos/houses (expats typically do not qualify)."
            },
            "notarial_fees": {
                "percent_min": 0.6,
                "percent_max": 0.9
            },
            "registration_fee": {
                "percent_min": 0.2,
                "percent_max": 0.4
            }
        },
        "Nayarit": {
            "acquisition_tax_isai": {
                "percent": 2.0,
                "notes": "Flat 2% ISAI rate for residential properties; reduced to 1% in tourist zones (Riviera Nayarit condos) ≤ $900K MXN (expats typically do not qualify for discount). Includes Riviera Nayarit and Sayulita - restricted zone applies."
            },
            "notarial_fees": {
                "percent_min": 0.6,
                "percent_max": 1.0
            },
            "registration_fee": {
                "percent_min": 0.2,
                "percent_max": 0.4
            },
            "restricted_zone": true
        },
        "Nuevo León": {
            "acquisition_tax_isai": {
                "percent": 3.0,
                "notes": "Flat 3% ISAI rate for residential properties; includes Monterrey. Full subsidy if ≤ $619K MXN (no prior property), 50% subsidy up to $1.24M MXN for houses/condos (expats typically do not qualify)."
            },
            "notarial_fees": {
                "percent_min": 0.7,
                "percent_max": 1.1
            },
            "registration_fee": {
                "percent_min": 0.3,
                "percent_max": 0.5
            }
        },
        "Oaxaca": {
            "acquisition_tax_isai": {
                "percent": 2.0,
                "notes": "Flat 2% ISAI rate for residential properties. Full exemptions for community/indigenous properties ≤ $500K MXN (expats typically do not qualify). Includes Pacific coast areas - restricted zone applies."
            },
            "notarial_fees": {
                "percent_min": 0.6,
                "percent_max": 0.9
            },
            "registration_fee": {
                "percent_min": 0.2,
                "percent_max": 0.4
            },
            "restricted_zone": true
        },
        "Puebla": {
            "acquisition_tax_isai": {
                "percent": 1.0,
                "notes": "Flat 1% ISAI rate for residential properties; one of the lowest in Mexico. 50% reduction for low-income first homes/condos ≤ $600K MXN (expats typically do not qualify)."
            },
            "notarial_fees": {
                "percent_min": 0.6,
                "percent_max": 0.9
            },
            "registration_fee": {
                "percent_min": 0.2,
                "percent_max": 0.3
            }
        },
        "Querétaro": {
            "acquisition_tax_isai": {
                "percent_min": 2.0,
                "percent_max": 6.5,
                "notes": "Flat 2% ISAI rate for residential properties; up to 6.5% for high-value properties. 75% subsidies for first homes ≤ $900K MXN (expats typically do not qualify)."
            },
            "notarial_fees": {
                "percent_min": 0.6,
                "percent_max": 1.0
            },
            "registration_fee": {
                "percent_min": 0.2,
                "percent_max": 0.4
            }
        },
        "Quintana Roo": {
            "acquisition_tax_isai": {
                "percent": 3.0,
                "notes": "Flat 3% ISAI rate for residential properties (per 2025 ley for tourist zones); 2% for social housing ≤ $1M MXN (expats typically do not qualify). Includes Cancún, Playa del Carmen, Tulum condos/land. Restricted zone applies."
            },
            "notarial_fees": {
                "percent_min": 0.6,
                "percent_max": 0.9
            },
            "registration_fee": {
                "percent_min": 0.3,
                "percent_max": 0.5
            },
            "restricted_zone": true,
            "tourist_tax": {
                "name": "VISITAX",
                "amount": 283,
                "currency": "MXN",
                "notes": "One-time tourist tax for visitors (not property buyers)"
            }
        },
        "San Luis Potosí": {
            "acquisition_tax_isai": {
                "percent": 2.0,
                "notes": "Flat 2% ISAI rate for residential properties. General social housing exemptions (expats typically do not qualify)."
            },
            "notarial_fees": {
                "percent_min": 0.6,
                "percent_max": 0.9
            },
            "registration_fee": {
                "percent_min": 0.2,
                "percent_max": 0.4
            }
        },
        "Sinaloa": {
            "acquisition_tax_isai": {
                "percent": 2.0,
                "notes": "Flat 2% ISAI rate for residential properties. 50% subsidy for first-time buyers of homes/condos ≤ $800K MXN (expats typically do not qualify). Includes Mazatlán - restricted zone applies."
            },
            "notarial_fees": {
                "percent_min": 0.6,
                "percent_max": 1.0
            },
            "registration_fee": {
                "percent_min": 0.2,
                "percent_max": 0.4
            },
            "restricted_zone": true
        },
        "Sonora": {
            "acquisition_tax_isai": {
                "percent": 2.0,
                "notes": "Flat 2% ISAI rate for residential properties. Full exemption in border zones ≤ $1M MXN for residential land (expats typically do not qualify). Includes Puerto Peñasco (Rocky Point) - border with Arizona, restricted zone applies."
            },
            "notarial_fees": {
                "percent_min": 0.6,
                "percent_max": 1.0
            },
            "registration_fee": {
                "percent_min": 0.2,
                "percent_max": 0.4
            },
            "restricted_zone": true
        },
        "Tabasco": {
            "acquisition_tax_isai": {
                "percent": 2.0,
                "notes": "Flat 2% ISAI rate for residential properties. Limited to low-value/family transfers of houses (expats typically do not qualify). Gulf coast state - restricted zone applies."
            },
            "notarial_fees": {
                "percent_min": 0.6,
                "percent_max": 0.9
            },
            "registration_fee": {
                "percent_min": 0.2,
                "percent_max": 0.4
            },
            "restricted_zone": true
        },
        "Tamaulipas": {
            "acquisition_tax_isai": {
                "percent": 3.0,
                "notes": "Flat 3% ISAI rate for residential properties; reduced to 2% for border first homes/condos ≤ $900K MXN (expats typically do not qualify). Border state with Texas - restricted zone applies."
            },
            "notarial_fees": {
                "percent_min": 0.6,
                "percent_max": 1.0
            },
            "registration_fee": {
                "percent_min": 0.2,
                "percent_max": 0.4
            },
            "restricted_zone": true
        },
        "Tlaxcala": {
            "acquisition_tax_isai": {
                "percent": 2.0,
                "notes": "Flat 2% ISAI rate for residential properties. Minor social interest reductions for condos (expats typically do not qualify). Smallest state in Mexico."
            },
            "notarial_fees": {
                "percent_min": 0.6,
                "percent_max": 0.9
            },
            "registration_fee": {
                "percent_min": 0.2,
                "percent_max": 0.3
            }
        },
        "Veracruz": {
            "acquisition_tax_isai": {
                "percent": 1.0,
                "notes": "Flat 1% ISAI rate for residential properties; one of the lowest in Mexico. 50% subsidy for low-income first homes/land ≤ $500K MXN (expats typically do not qualify). Gulf coast state - restricted zone applies."
            },
            "notarial_fees": {
                "percent_min": 0.6,
                "percent_max": 0.9
            },
            "registration_fee": {
                "percent_min": 0.2,
                "percent_max": 0.4
            },
            "restricted_zone": true
        },
        "Yucatán": {
            "acquisition_tax_isai": {
                "percent": 0.02,
                "notes": "Minimal flat 0.02% ISAI rate for residential properties - lowest in Mexico (per merida.gob.mx). Up to 50% subsidy in Mérida for first buyers ≤ $800K MXN (expats typically do not qualify). Includes Mérida - restricted zone applies."
            },
            "notarial_fees": {
                "percent_min": 0.6,
                "percent_max": 0.9
            },
            "registration_fee": {
                "percent_min": 0.2,
                "percent_max": 0.4
            },
            "restricted_zone": true
        },
        "Zacatecas": {
            "acquisition_tax_isai": {
                "percent": 2.0,
                "notes": "Flat 2% ISAI rate for residential properties. 50% subsidy for rural first homes/land ≤ $600K MXN (expats typically do not qualify)."
            },
            "notarial_fees": {
                "percent_min": 0.6,
                "percent_max": 0.9
            },
            "registration_fee": {
                "percent_min": 0.2,
                "percent_max": 0.4
            }
        }
    },
    "calculation_instructions": {
        "overview": "How to calculate total closing costs using this database",
        "steps": [
            "1. Get the purchase price from the user",
            "2. Get the state where the property is located",
            "3. For each fee in fee_definitions, check if varies_by_state is true",
            "4. If varies_by_state is true, look up the state-specific values in state_rates[state_name]",
            "5. If no state-specific value exists, use the default values from fee_definitions",
            "6. Apply calculations based on calc_type:",
            "   - fixed: Use the exact value",
            "   - fixed_range: Show the range (min to max) or ask user preference",
            "   - percent: Multiply the percentage by purchase price",
            "   - percent_range: Show range by multiplying min and max percentages by purchase price",
            "   - user_entered: Prompt user to provide the amount",
            "7. Sum all applicable fees to get total closing costs",
            "8. Display breakdown by category"
        ],
        "important_notes": [
            "ALL ISAI RATES APPLY TO RESIDENTIAL PROPERTIES ONLY (condos, houses, residential land). Commercial, agricultural, and other property types may have different rates.",
            "ISAI is charged on the HIGHER of purchase price or assessed (cadastral) value",
            "Assessed values in Mexico are typically 60-70% of market value",
            "Fideicomiso fees only apply to foreign buyers in restricted zones (50km from coast, 100km from border)",
            "Expats generally DO NOT QUALIFY for primary residence discounts or social housing subsidies - these are typically for Mexican citizens only",
            "Annual Predial (property tax) is separate and typically 0.1-0.3% of assessed value per year",
            "Some municipalities offer early payment discounts on Predial (6-10% if paid Jan-Feb)",
            "Capital gains tax on sale is typically 25% of gross or 35% of net gain",
            "All percentages in this database should be divided by 100 (e.g., 2.0 means 2%, not 200%)"
        ]
    },
    "glossary": {
        "ISAI": "Impuesto Sobre Adquisición de Inmuebles - Property Acquisition Tax",
        "Escritura Pública": "Public deed of property ownership",
        "Fideicomiso": "Bank trust required for foreign buyers in restricted zones",
        "Predial": "Annual municipal property tax",
        "Valor Catastral": "Assessed/cadastral value (typically 60-70% of market value)",
        "Gastos de Registro": "Registration fees for Public Registry of Property",
        "Restricted Zone": "Areas within 50km of coastline or 100km of international border where foreigners cannot hold direct title",
        "RFC": "Registro Federal de Contribuyentes - Mexican tax ID number"
    },
    "python_renderer": {
        "version": "1.3.2",
        "language": "python",
        "filename": "cierre_sensei_report.py",
        "description": "Generates printable PNG reports for Cierre Sensei (US Letter, white margins, spaced columns).",
        "code": "from datetime import date\nfrom PIL import Image, ImageDraw, ImageFont\n\n\ndef _load_font(size: int, bold: bool = False, italic: bool = False) -> ImageFont.FreeTypeFont:\n    \"\"\"\n    Try to load a reasonable TrueType font; fall back to the default bitmap font.\n    \"\"\"\n    font_candidates = []\n    if bold and italic:\n        font_candidates.extend([\n            \"DejaVuSans-BoldOblique.ttf\",\n            \"Arial Bold Italic.ttf\",\n            \"Arial-BoldItalic.ttf\",\n        ])\n    elif bold:\n        font_candidates.extend([\n            \"DejaVuSans-Bold.ttf\",\n            \"Arial Bold.ttf\",\n            \"Arial-Bold.ttf\",\n        ])\n    elif italic:\n        font_candidates.extend([\n            \"DejaVuSans-Oblique.ttf\",\n            \"Arial Italic.ttf\",\n            \"Arial-Italic.ttf\",\n        ])\n    else:\n        font_candidates.extend([\n            \"DejaVuSans.ttf\",\n            \"Arial.ttf\",\n        ])\n\n    for name in font_candidates:\n        try:\n            return ImageFont.truetype(name, size=size)\n        except Exception:\n            continue\n\n    # Fallback – always available but not as pretty\n    return ImageFont.load_default()\n\n\ndef _get_font_size(font) -> int:\n    \"\"\"Get font size, handling both TrueType and default fonts.\"\"\"\n    try:\n        return font.size\n    except AttributeError:\n        # Default font doesn't have .size, use a reasonable estimate\n        # Most default fonts are around 10-12 pixels, but we'll estimate based on context\n        # For now, return a safe default that matches typical usage\n        return 12\n\n\ndef generate_cierre_sensei_png(\n    purchase_summary: dict,\n    addons: list,\n    line_items: list,\n    est_min: float,\n    est_max: float,\n    eff_min_pct: float,\n    eff_max_pct: float,\n    filename: str = \"cierre_sensei_report.png\",\n    prepared_date: str | None = None,\n    theme: str = \"dark\",\n    sponsor_text: str | dict | None = None,\n) -> Image.Image:\n    \"\"\"\n    Generate a printable PNG report for Cierre Sensei.\n    \n    Args:\n        purchase_summary: dict with keys like Purchase Price, Type, State, etc.\n        addons: list of strings, e.g. [\"Title Insurance\", \"Home Inspection\", ...]\n        line_items: list of tuples: (description, min_amount, max_amount, notes)\n        est_min / est_max: numeric totals for the estimated range\n        eff_min_pct / eff_max_pct: effective % of purchase price\n        filename: output PNG filename\n        prepared_date: optional string like \"12/1/2025\"; if None, today is used\n        theme: \"dark\" (dark blue background) or \"light\" (white background, printer-friendly)\n        sponsor_text: optional text to display centered above footer. Can be:\n            - str: simple text (backward compatible)\n            - dict: structured format with keys: intro, company, website, tagline, contact\n    \"\"\"\n    \n    # Theme-based color scheme\n    if theme == \"light\":\n        # Light theme: white background, black text (printer-friendly)\n        bg_color = (255, 255, 255)\n        title_color = (0, 0, 0)\n        text_color = (0, 0, 0)\n        separator_color = (0, 0, 0)\n        box_outline = (0, 0, 0)\n    else:\n        # Dark theme: dark blue background (default)\n        bg_color = (30, 50, 80)\n        title_color = (100, 150, 255)\n        text_color = (255, 255, 255)\n        separator_color = (150, 180, 220)\n        box_outline = (150, 180, 220)\n    \n    # Canvas setup (US Letter @ ~300dpi)\n    WIDTH, HEIGHT = 2550, 3300\n    margin_x = 260\n    margin_y = 260\n    \n    img = Image.new(\"RGB\", (WIDTH, HEIGHT), bg_color)\n    draw = ImageDraw.Draw(img)\n    \n    # Fonts\n    title_font = _load_font(80, bold=True)\n    subtitle_font = _load_font(44, bold=False)\n    normal_font = _load_font(34)\n    small_bold = _load_font(30, bold=True)\n    \n    # Prepare date - cross-platform format\n    if prepared_date is None:\n        today = date.today()\n        prepared_date = f\"{today.month}/{today.day}/{today.year}\"\n    \n    # --- Header ---\n    y = margin_y\n    title_text = \"Cierre Sensei\"\n    prepared_text = f\"Prepared: {prepared_date}\"\n    \n    draw.text((margin_x, y), title_text, font=title_font, fill=title_color)\n    \n    # Right-aligned prepared date\n    bbox = draw.textbbox((0, 0), prepared_text, font=small_bold)\n    date_w = bbox[2] - bbox[0]\n    draw.text((WIDTH - margin_x - date_w, y + 10),\n              prepared_text, font=small_bold, fill=text_color)\n    \n    y += _get_font_size(title_font) + 40\n    draw.text((margin_x, y), \"Closing Costs Estimation\",\n              font=subtitle_font, fill=text_color)\n    y += _get_font_size(subtitle_font) + 40\n    \n    # --- Add-ons (left) ---\n    ax = margin_x\n    ay = y\n    draw.text((ax, ay), \"Addons:\", font=normal_font, fill=text_color)\n    ay += _get_font_size(normal_font) + 12\n    \n    for item in addons:\n        draw.text((ax + 40, ay), f\"• {item}\", font=normal_font, fill=text_color)\n        ay += _get_font_size(normal_font) + 10\n    \n    addons_bottom = ay\n    \n    # --- Purchase summary box (right) ---\n    box_width = 860\n    bx = WIDTH - margin_x - box_width\n    by = y\n    \n    lines = [f\"{k}:  {v}\" for k, v in purchase_summary.items()]\n    line_height = _get_font_size(normal_font) + 8\n    box_height = line_height * len(lines) + 26\n    \n    draw.rectangle([bx, by, bx + box_width, by + box_height],\n                   outline=box_outline, width=3)\n    \n    ty = by + 14\n    for line in lines:\n        draw.text((bx + 18, ty), line, font=normal_font, fill=text_color)\n        ty += line_height\n    \n    summary_bottom = by + box_height\n    \n    # Move y below the higher of the two blocks\n    y = max(addons_bottom, summary_bottom) + 90\n    \n    # --- Table header ---\n    desc_x = margin_x\n    min_x = desc_x + 900\n    max_x = min_x + 420\n    notes_x = max_x + 420\n    \n    header_y = y\n    draw.text((desc_x, header_y), \"Description\",\n              font=small_bold, fill=text_color)\n    draw.text((min_x, header_y), \"Min Amount\",\n              font=small_bold, fill=text_color)\n    draw.text((max_x, header_y), \"Max Amount\",\n              font=small_bold, fill=text_color)\n    draw.text((notes_x, header_y), \"Notes\",\n              font=small_bold, fill=text_color)\n    \n    y += _get_font_size(small_bold) + 12\n    draw.line((margin_x, y, WIDTH - margin_x, y),\n              fill=separator_color, width=2)\n    y += 26\n    \n    # --- Table rows ---\n    def fmt_currency(val: float) -> str:\n        return \"${:,.0f}\".format(val)\n    \n    row_height = _get_font_size(normal_font) + 18\n    \n    for desc, min_v, max_v, notes in line_items:\n        # description\n        draw.text((desc_x, y), desc, font=normal_font, fill=text_color)\n        \n        # min / max\n        draw.text((min_x, y), fmt_currency(min_v),\n                  font=normal_font, fill=text_color)\n        draw.text((max_x, y), fmt_currency(max_v),\n                  font=normal_font, fill=text_color)\n        \n        # notes\n        if notes:\n            draw.text((notes_x, y), notes, font=normal_font, fill=text_color)\n        \n        y += row_height\n    \n    # --- Totals section ---\n    y += 100\n    # Estimated Range label and value\n    draw.text((margin_x, y), \"Estimated Range:\",\n              font=_load_font(40, bold=True), fill=text_color)\n    draw.text((margin_x + 420, y),\n              f\"{fmt_currency(est_min)} – {fmt_currency(est_max)}\",\n              font=_load_font(40), fill=text_color)\n    \n    y += 40 + 18\n    \n    # Effective Rate label and value\n    draw.text((margin_x, y), \"Effective Rate %:\",\n              font=_load_font(40, bold=True), fill=text_color)\n    draw.text((margin_x + 420, y),\n              f\"{eff_min_pct:.1f}% – {eff_max_pct:.1f}%\",\n              font=_load_font(40), fill=text_color)\n    \n    # --- SPONSOR TEXT (if provided) ---\n    if sponsor_text:\n        # Fonts for sponsor section\n        sponsor_intro_font = _load_font(24, bold=False, italic=True)  # \"brought to you by:\" in italic\n        sponsor_company_font = _load_font(36, bold=True)  # COMPANY NAME large\n        sponsor_detail_font = _load_font(26, bold=False)  # website, tagline, contact\n        \n        # Start position (centered, above footer)\n        sponsor_start_y = HEIGHT - 200\n        \n        # Handle structured dict format\n        if isinstance(sponsor_text, dict):\n            current_y = sponsor_start_y\n            \n            # Intro line: \"brought to you by:\" (italic)\n            if sponsor_text.get(\"intro\"):\n                intro_text = sponsor_text[\"intro\"]\n                intro_bbox = draw.textbbox((0, 0), intro_text, font=sponsor_intro_font)\n                intro_w = intro_bbox[2] - intro_bbox[0]\n                intro_x = (WIDTH - intro_w) // 2\n                draw.text((intro_x, current_y), intro_text, font=sponsor_intro_font, fill=text_color)\n                current_y += _get_font_size(sponsor_intro_font) + 8\n            \n            # Company name (large, bold)\n            if sponsor_text.get(\"company\"):\n                company_text = sponsor_text[\"company\"]\n                company_bbox = draw.textbbox((0, 0), company_text, font=sponsor_company_font)\n                company_w = company_bbox[2] - company_bbox[0]\n                company_x = (WIDTH - company_w) // 2\n                draw.text((company_x, current_y), company_text, font=sponsor_company_font, fill=text_color)\n                current_y += _get_font_size(sponsor_company_font) + 10\n            \n            # Website (if available)\n            if sponsor_text.get(\"website\"):\n                website_text = sponsor_text[\"website\"]\n                website_bbox = draw.textbbox((0, 0), website_text, font=sponsor_detail_font)\n                website_w = website_bbox[2] - website_bbox[0]\n                website_x = (WIDTH - website_w) // 2\n                draw.text((website_x, current_y), website_text, font=sponsor_detail_font, fill=text_color)\n                current_y += _get_font_size(sponsor_detail_font) + 6\n            \n            # Tagline (if available)\n            if sponsor_text.get(\"tagline\"):\n                tagline_text = sponsor_text[\"tagline\"]\n                tagline_bbox = draw.textbbox((0, 0), tagline_text, font=sponsor_detail_font)\n                tagline_w = tagline_bbox[2] - tagline_bbox[0]\n                tagline_x = (WIDTH - tagline_w) // 2\n                draw.text((tagline_x, current_y), tagline_text, font=sponsor_detail_font, fill=text_color)\n                current_y += _get_font_size(sponsor_detail_font) + 6\n            \n            # Contact (if available)\n            if sponsor_text.get(\"contact\"):\n                contact_text = sponsor_text[\"contact\"]\n                contact_bbox = draw.textbbox((0, 0), contact_text, font=sponsor_detail_font)\n                contact_w = contact_bbox[2] - contact_bbox[0]\n                contact_x = (WIDTH - contact_w) // 2\n                draw.text((contact_x, current_y), contact_text, font=sponsor_detail_font, fill=text_color)\n        else:\n            # Backward compatible: simple string\n            sponsor_bbox = draw.textbbox((0, 0), sponsor_text, font=small_bold)\n            sponsor_w = sponsor_bbox[2] - sponsor_bbox[0]\n            sponsor_x = (WIDTH - sponsor_w) // 2\n            draw.text((sponsor_x, sponsor_start_y), sponsor_text, font=small_bold, fill=text_color)\n    \n    # --- FOOTER ---\n    footer_y = HEIGHT - 80\n    \n    # Disclaimer\n    disclaimer = \"Informational only; confirm with local professionals.\"\n    disc_bbox = draw.textbbox((0, 0), disclaimer, font=small_bold)\n    disc_w = disc_bbox[2] - disc_bbox[0]\n    disc_x = WIDTH - margin_x - disc_w\n    draw.text((disc_x, footer_y), disclaimer, font=small_bold, fill=text_color)\n    \n    img.save(filename)\n    return img\n\n\n# --------------------------------------------------------------------\n# Example stand-alone usage\n# --------------------------------------------------------------------\nif __name__ == \"__main__\":\n    purchase_summary_example = {\n        \"Purchase Price\": \"$500,000 USD\",\n        \"Type\": \"Condo\",\n        \"State\": \"Quintana Roo\",\n        \"Restricted Zone\": \"Yes\",\n        \"Foreign Buyer\": \"Yes\",\n    }\n\n    addons_example = [\n        \"Title Insurance\",\n        \"Home Inspection\",\n        \"Attorney\",\n        \"Translator\",\n        \"Closing Coordinator\",\n    ]\n\n    line_items_example = [\n        (\"ISAI 3%\",            15000, 15000, \"% of purchase price\"),\n        (\"Notarial Fees\",       3000,  4500, \"Range\"),\n        (\"Registration\",        1500,  2500, \"\"),\n        (\"Escrow\",               750,   750, \"Flat fee\"),\n        (\"Certificates\",          40,    60, \"\"),\n        (\"Appraisal\",            500,  2500, \"\"),\n        (\"Fideicomiso Setup\",   1000,  2000, \"If restricted + foreign\"),\n        (\"Fideicomiso Permit\",  1100,  1100, \"One-time fee\"),\n        (\"Fideicomiso Annual\",   500,   800, \"Recurring\"),\n        (\"Title Insurance\",     1500,  1500, \"\"),\n        (\"Home Inspection\",      500,   500, \"\"),\n        (\"Attorney\",            2500,  2500, \"\"),\n        (\"Translator\",           500,   500, \"\"),\n        (\"Closing Coordinator\",  750,   750, \"\"),\n    ]\n\n    img = generate_cierre_sensei_png(\n        purchase_summary=purchase_summary_example,\n        addons=addons_example,\n        line_items=line_items_example,\n        est_min=29140,\n        est_max=34960,\n        eff_min_pct=5.8,\n        eff_max_pct=7.0,\n        filename=\"cierre_sensei_report.png\",\n        prepared_date=\"12/1/2025\",\n        theme=\"dark\",\n    )\n\n    print(\"Saved cierre_sensei_report.png\")\n\n"
    }
}
